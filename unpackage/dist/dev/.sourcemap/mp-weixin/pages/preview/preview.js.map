{"version":3,"file":"preview.js","sources":["pages/preview/preview.vue","C:/Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNccHJldmlld1xwcmV2aWV3LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"preview\">\n    <swiper\n      :previous-margin=\"'120rpx'\"\n      :next-margin=\"'120rpx'\"\n      display-multiple-items=\"1\"\n      :duration=\"300\"\n      @change=\"onSwiperChange\"\n      @transition=\"onSwiperTransition\"\n      :current=\"currentIndex\"\n    >\n      <swiper-item\n        v-for=\"(item, index) in wallList\"\n        :key=\"item.id\"\n        :class=\"index === currentIndex ? 'swiper-item-active' : ''\"\n      >\n        <image @click=\"hide\" :src=\"item.picurl\" mode=\"aspectFill\"></image>\n      </swiper-item>\n    </swiper>\n\n    <view class=\"mask\" v-if=\"mask\">\n      <view\n        class=\"back\"\n        @click=\"back\"\n        :style=\"{ top: statusBarHeight() + 'px' }\"\n      >\n        <uni-icons type=\"back\" size=\"20\" color=\"#fff\"></uni-icons>\n      </view>\n      <view class=\"operation\">\n        <button open-type=\"share\" class=\"operation-but\">\n          <span class=\"material-symbols-outlined\"> share </span>\n        </button>\n        <view class=\"downloadbgc\" @tap=\"downloadFile\">\n          <span class=\"material-symbols-outlined icon2\"> download </span>\n        </view>\n\n        <view\n          class=\"favorite-btn\"\n          :class=\"{ 'favorited': isFavorited }\"\n          @tap=\"toggleFavorite\"\n        >\n          <span class=\"material-symbols-outlined icon2\">\n            {{ isFavorited ? 'favorite' : 'favorite_border' }}\n          </span>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { statusBarHeight } from '@/utils/sys.js'\nimport { onLoad } from '@dcloudio/uni-app'\nimport { ref } from 'vue'\nimport { toggleFavorite as toggleFav, isFavorite as checkFav } from '@/utils/favorite.js'\nimport { addDownload, isDownloaded as checkDownloaded } from '@/utils/download.js'\n\nconst mask = ref(true)\nconst infopopup = ref(null)\nconst starpopup = ref(null)\nconst wallList = ref([])\nconst current = ref(null)\nconst currentIndex = ref(0)\nconst isFavorited = ref(false)\nconst isDownloaded = ref(false)\n\nonLoad((e) => {\n  // 转换 ID 为字符串，确保类型一致性\n  const id = String(e.id)\n  current.value = id\n\n  // 从 localStorage 读取存储的壁纸列表数据\n  const storgwallList = uni.getStorageSync('storgwallList') || []\n\n  // 转换数据格式，使用 download_url 作为 picurl\n  wallList.value = storgwallList.map((item) => ({\n    ...item,\n    picurl: item.download_url,\n  }))\n\n  // 找到当前点击的图片索引（转换为字符串比较，避免类型不匹配）\n  const index = wallList.value.findIndex(\n    (item) => String(item.id) === id\n  )\n  if (index !== -1) {\n    currentIndex.value = index\n  }\n\n  // 检查收藏和下载状态\n  checkFavoriteStatus()\n  checkDownloadStatus()\n})\n\n// swiper 变化事件\nconst onSwiperChange = (e) => {\n  currentIndex.value = e.detail.current\n  checkFavoriteStatus()\n  checkDownloadStatus()\n}\n\n// swiper 过渡事件\nconst onSwiperTransition = (e) => {\n  // 可以在这里处理过渡动画，但保持简洁避免性能问题\n  // 目前留空，让 CSS transitions 处理动画\n}\n\n// 检查收藏状态\nconst checkFavoriteStatus = () => {\n  const currentImage = wallList.value[currentIndex.value]\n  if (currentImage) {\n    isFavorited.value = checkFav(currentImage)\n  }\n}\n\n// 检查下载状态\nconst checkDownloadStatus = () => {\n  const currentImage = wallList.value[currentIndex.value]\n  if (currentImage) {\n    isDownloaded.value = checkDownloaded(currentImage)\n  }\n}\n\n// 收藏\nconst toggleFavorite = () => {\n  const currentImage = wallList.value[currentIndex.value]\n  if (!currentImage) return\n\n  // 调用工具函数切换收藏\n  const newState = toggleFav(currentImage)\n\n  // 更新状态\n  isFavorited.value = newState\n\n  // 震动反馈\n  if (uni.vibrateShort) {\n    uni.vibrateShort()\n  }\n}\n\n// 下载\nconst downloadFile = () => {\n  // 获取当前图片\n  const currentImage = wallList.value[currentIndex.value]\n  if (!currentImage || !currentImage.picurl) {\n    uni.showToast({\n      title: '图片不存在',\n      icon: 'none'\n    })\n    return\n  }\n\n  uni.showLoading({\n    title: '下载中...'\n  })\n\n  // 下载文件\n  uni.downloadFile({\n    url: currentImage.picurl,\n    success: (res) => {\n      if (res.statusCode === 200) {\n        // 保存到相册\n        uni.saveImageToPhotosAlbum({\n          filePath: res.tempFilePath,\n          success: () => {\n            uni.hideLoading()\n            // 添加下载记录\n            addDownload(currentImage)\n            // 更新下载状态\n            isDownloaded.value = true\n            uni.showToast({\n              title: '已保存到相册',\n              icon: 'success'\n            })\n          },\n          fail: (err) => {\n            uni.hideLoading()\n            // 如果是权限问题，引导用户开启权限\n            if (err.errMsg.includes('auth')) {\n              uni.showModal({\n                title: '提示',\n                content: '需要您授权保存相册权限',\n                success: (modalRes) => {\n                  if (modalRes.confirm) {\n                    uni.openSetting()\n                  }\n                }\n              })\n            } else {\n              uni.showToast({\n                title: '保存失败',\n                icon: 'none'\n              })\n            }\n          }\n        })\n      } else {\n        uni.hideLoading()\n        uni.showToast({\n          title: '下载失败',\n          icon: 'none'\n        })\n      }\n    },\n    fail: (err) => {\n      uni.hideLoading()\n      console.error('下载失败:', err)\n      uni.showToast({\n        title: '下载失败',\n        icon: 'none'\n      })\n    }\n  })\n}\n//隐藏遮罩层\nconst hide = () => {\n  console.log(mask.value)\n  mask.value = !mask.value\n}\n\n//返回首页\nconst back = () => {\n  uni.navigateBack()\n}\n\n//信息弹出层\nconst infoopen = () => {\n  infopopup.value.open('bottom')\n}\n\n//关闭弹出层\nconst close = () => {\n  infopopup.value.close()\n  starpopup.value.close()\n}\n\n//打开评分弹出层\nconst staropen = () => {\n  starpopup.value.open()\n}\n\n//确认评分\nconst submit = () => {\n  starpopup.value.close()\n}\n</script>\n<style lang=\"scss\" scoped>\n.preview {\n  width: 100%;\n  height: 100vh;\n  position: relative;\n  background: #1a1a1a;\n\n  swiper {\n    height: 100%;\n    width: 100%;\n\n    swiper-item {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n\n      image {\n        width: 100%;\n        height: 60%;\n        border-radius: 24rpx;\n        box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.6);\n        transition: transform 0.3s ease, opacity 0.3s ease, height 0.3s ease;\n        opacity: 0.5;\n        transform: scale(0.9);\n      }\n\n      &.swiper-item-active image {\n        height: 60%;\n        opacity: 1;\n        transform: scale(1);\n        box-shadow: 0 12rpx 40rpx rgba(0, 0, 0, 0.7);\n      }\n    }\n  }\n\n  .mask {\n    & > view {\n      position: absolute;\n      color: #fff;\n      z-index: 10;\n    }\n    display: flex;\n    justify-content: center;\n    .back {\n      border: 1px solid rgba(255, 255, 255, 0.3);\n      top: 0;\n      left: 30rpx;\n      border-radius: 100px;\n      width: 38px;\n      height: 38px;\n      background: rgba(0, 0, 0, 0.5);\n      margin-left: 0;\n      backdrop-filter: blur(10rpx);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .count {\n      top: 10vh;\n      background: rgba(0, 0, 0, 0.7);\n      border-radius: 40rpx;\n      font-size: 28rpx;\n      padding: 8rpx 28rpx;\n      backdrop-filter: blur(10rpx);\n    }\n    .time {\n      top: calc(10vh + 80rpx);\n      font-size: 140rpx;\n      font-weight: 100;\n      line-height: 1em;\n      text-shadow: 0 4rpx rgba(0, 0, 0, 0.3);\n    }\n    .date {\n      top: calc(10vh + 230rpx);\n      font-size: 34rpx;\n      text-shadow: 0 2rpx rgba(0, 0, 0, 0.3);\n    }\n    .operation {\n      bottom: 10vh;\n      width: 30vh;\n      height: 120rpx;\n      display: flex;\n      justify-content: space-around;\n      align-items: center;\n      border-radius: 120rpx;\n      &-but {\n        background: none;\n        color:#fff;\n        border: none;\n        padding: 0;\n        margin: 0;\n        box-shadow: none;\n        border-radius: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n      .downloadbgc {\n        background-color: #6836dd;\n        border-radius: 100%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 120rpx;\n        height: 120rpx;\n      }\n      .favorite-btn {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        // width: 120rpx;\n        // height: 120rpx;\n        border-radius: 100%;\n        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n\n        .material-symbols-outlined {\n          font-size: 48rpx;\n          color: #fff;\n          transition: all 0.3s ease;\n        }\n\n        &.favorited {\n          .material-symbols-outlined {\n            color: #ff4757;\n            animation: heartbeat 0.4s ease-in-out;\n          }\n        }\n\n        &:active {\n          transform: scale(0.8);\n        }\n      }\n    }\n    .info {\n      bottom: 10vh;\n      background: rgba(255, 255, 255, 0.8);\n      width: 30vh;\n      height: 120rpx;\n      // color: #000;\n      display: flex;\n      justify-content: space-around;\n      align-items: center;\n      border-radius: 120rpx;\n      box-shadow: 0 2rpx 0 rgba(0, 0, 0, 0.1);\n      backdrop-filter: blur(20rpx);\n      .box {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 2rpx 12rpx;\n        .text {\n          font-size: 26rpx;\n          color: $font2;\n        }\n      }\n    }\n  }\n  .Header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .title {\n      color: $font2;\n      font-size: 26rpx;\n    }\n    .close {\n      padding: 6rpx;\n    }\n  }\n  .infopopup {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 30rpx 30rpx 0 0;\n    // overflow: hidden;\n    scroll-view {\n      max-height: 50vh;\n      .content {\n        .row {\n          display: flex;\n          padding: 16rpx 0;\n          font-size: 32rpx;\n          line-height: 1.7em;\n          .label {\n            color: $font3;\n            width: 140rpx;\n            text-align: right;\n            font-size: 30rpx;\n          }\n          .value {\n            flex: 1;\n            width: 0;\n          }\n          .star {\n            display: flex;\n            align-items: center;\n            .score {\n              font-size: 26rpx;\n              color: $font3;\n              padding-left: 20rpx;\n            }\n          }\n          .tabs {\n            display: flex;\n            flex-wrap: wrap;\n            .tab {\n              border: 1px solid $theme-c;\n              color: $theme-c;\n              font-size: 22rpx;\n              padding: 10rpx 30rpx;\n              border-radius: 40rpx;\n              line-height: 1em;\n              margin: 0 10rpx 10rpx 0;\n            }\n          }\n        }\n        .copyright {\n          font-size: 28rpx;\n          padding: 20rpx;\n          background: #f6f6f6;\n          color: #666;\n          border-radius: 10rpx;\n          margin: 20rpx 0;\n          line-height: 1.6em;\n        }\n      }\n    }\n  }\n  .starpopup {\n    background: #fff;\n    border-radius: 30rpx;\n    padding: 30rpx;\n    // width: 70vh;\n    .content {\n      display: flex;\n      padding: 30rpx;\n      justify-content: center;\n      align-items: center;\n      .text {\n        color: #ffca3e;\n        padding-left: 10rpx;\n        width: 80rpx;\n        line-height: 1em;\n        text-align: right;\n      }\n    }\n    .footer {\n      display: flex;\n      justify-content: center;\n      padding: 10rpx 0;\n      button {\n        color: $font3;\n      }\n    }\n  }\n}\n\n// 心跳动画\n@keyframes heartbeat {\n  0% {\n    transform: scale(1);\n  }\n  25% {\n    transform: scale(1.3);\n  }\n  50% {\n    transform: scale(1);\n  }\n  75% {\n    transform: scale(1.3);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n</style>\n","import MiniProgramPage from 'E:/uniapp/壁纸案例/pages/preview/preview.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","uni","checkFav","checkDownloaded","toggleFav","addDownload"],"mappings":"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"}